task verifyCommonSdkVersion {
    String commonLibDependencyCore = getCommonLibDependency("libnavigation-core")
    String commonLibDependencyNavigator = getCommonLibDependency("libnavigator")
    if (commonLibDependencyCore != commonLibDependencyNavigator) {
        throw new GradleException("Navigation SDK and Navigation Native have different versions of" +
                "Common SDK library. Please align Common SDK version in both SDKs before push changes.")
    }
}

def getCommonLibDependency(String moduleName) {
    File dependenciesFile = new File(moduleName + '_dependencies.txt')
    if (dependenciesFile.exists() ) {
        project.delete(moduleName + '_dependencies.txt')
    }

    "./gradlew :" + moduleName + ":dependencyInsight --dependency com.mapbox.common:common: --configuration releaseRuntimeClasspath >> " + moduleName + "_dependencies.txt"
            .execute().text.trim()

    dependenciesFile = new File(moduleName + '_dependencies.txt')
    int firstIndexCommonLib = dependenciesFile.text.indexOf("com.mapbox.common:common:")
    int lastIndexCommonLib = dependenciesFile.text.indexOf("variant", firstIndexCommonLib)
    String commonLibDependency = dependenciesFile.text.substring(firstIndexCommonLib, lastIndexCommonLib)
    return commonLibDependency
}